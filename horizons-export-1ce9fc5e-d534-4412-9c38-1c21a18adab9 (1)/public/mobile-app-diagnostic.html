<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#000000" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  
  <title>üì± Mobile Diagnostic - Heresse PWA</title>
  
  <!-- PWA Meta -->
  <link rel="manifest" href="/manifest.json" />
  <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg" />
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon-180x180.png" />
  
  <style>
    /* Reset et styles de base pour √©viter tout conflit */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html, body {
      height: 100%;
      overflow-x: hidden;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #1a1a1a;
      color: #ffffff;
      
      /* iOS PWA fixes */
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none; /* Propri√©t√© standard pour compatibilit√© */
      -webkit-tap-highlight-color: transparent;
      
      /* Prevent zoom */
      touch-action: manipulation;
    }
    
    #root {
      min-height: 100vh;
      width: 100%;
    }
    
    /* Loading fallback */
    .loading-fallback {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
      text-align: center;
    }
    
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #333;
      border-top: 4px solid #10b981;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .fallback-button {
      background: #10b981;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin: 10px;
    }
    
    .fallback-button:active {
      background: #059669;
    }
  </style>
</head>
<body>
  <div id="root">
    <!-- Fallback si React ne charge pas -->
    <div class="loading-fallback">
      <div class="loading-spinner"></div>
      <h1 style="color: #10b981; margin-bottom: 20px;">üì± Mobile Diagnostic</h1>
      <p style="margin-bottom: 20px; color: #9ca3af;">
        Chargement de l'application de diagnostic React...
      </p>
      <div id="loading-logs" style="background: #333; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 12px; margin: 20px 0; text-align: left; max-height: 200px; overflow-y: auto;">
        [Initialisation] Chargement en cours...<br>
      </div>
      <button class="fallback-button" onclick="window.location.href='/'">
        üè† App Principale
      </button>
      <button class="fallback-button" onclick="window.location.href='/mobile-diagnostic.html'">
        üîç Diagnostic HTML
      </button>
      <button class="fallback-button" onclick="window.location.href='/react-mobile-test.html'">
        üß™ Test React
      </button>
    </div>
  </div>

  <script>
    // Logger pour la fallback
    const loadingLogs = document.getElementById('loading-logs');
    const addLoadingLog = (message) => {
      const timestamp = new Date().toLocaleTimeString();
      loadingLogs.innerHTML += `[${timestamp}] ${message}<br>`;
      loadingLogs.scrollTop = loadingLogs.scrollHeight;
    };
    
    // Informations de d√©marrage
    addLoadingLog(`User Agent: ${navigator.userAgent.substring(0, 50)}...`);
    addLoadingLog(`Screen: ${screen.width}x${screen.height}`);
    addLoadingLog(`Viewport: ${window.innerWidth}x${window.innerHeight}`);
    addLoadingLog(`Touch: ${('ontouchstart' in window) ? 'Support√©' : 'Non support√©'}`);
    addLoadingLog(`PWA Mode: ${window.matchMedia('(display-mode: standalone)').matches ? 'Standalone' : 'Browser'}`);
    
    // Capture d'erreurs avant React
    window.addEventListener('error', (e) => {
      addLoadingLog(`‚ùå ERREUR: ${e.message}`);
      console.error('Pre-React error:', e);
    });
    
    window.addEventListener('unhandledrejection', (e) => {
      addLoadingLog(`‚ùå PROMISE: ${e.reason}`);
      console.error('Pre-React promise rejection:', e);
    });
    
    // Timeout pour d√©tecter si React ne charge pas
    const reactTimeout = setTimeout(() => {
      addLoadingLog('‚ö†Ô∏è React prend du temps √† charger...');
      
      // Afficher plus d'infos apr√®s 5 secondes
      setTimeout(() => {
        addLoadingLog('‚ùå React semble avoir √©chou√© √† charger');
        addLoadingLog('üîß Utilisation du diagnostic HTML en fallback');
        
        // Proposer une redirection automatique
        const autoRedirect = confirm('React ne r√©pond pas. Voulez-vous √™tre redirig√© vers le diagnostic HTML ?');
        if (autoRedirect) {
          window.location.href = '/mobile-diagnostic.html';
        }
      }, 5000);
    }, 3000);
    
    // Si React charge, annuler le timeout
    window.addEventListener('DOMContentLoaded', () => {
      addLoadingLog('‚úÖ DOM charg√©, tentative de d√©marrage React...');
    });
    
    // Observer si le contenu change (React a pris le contr√¥le)
    const observer = new MutationObserver((mutations) => {
      const hasReactContent = document.querySelector('[data-reactroot]') || 
                              document.querySelector('#root > div:not(.loading-fallback)');
      
      if (hasReactContent) {
        addLoadingLog('‚úÖ React d√©tect√©, arr√™t du fallback');
        clearTimeout(reactTimeout);
        observer.disconnect();
      }
    });
    
    observer.observe(document.getElementById('root'), {
      childList: true,
      subtree: true
    });
  </script>

  <!-- Chargement de React diagnostic -->
  <script type="module" src="/src/main-mobile-diagnostic.jsx"></script>
</body>
</html>
