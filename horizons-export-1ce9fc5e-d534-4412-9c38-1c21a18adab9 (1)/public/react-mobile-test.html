<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>üß™ Test React Mobile Simple</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: white;
            min-height: 100vh;
        }
        
        .container {
            max-width: 100%;
            text-align: center;
        }
        
        .status {
            background: #333;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 14px;
            text-align: left;
        }
        
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .warning { color: #fbbf24; }
        
        button {
            background: #10b981;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 10px;
            width: 100%;
            max-width: 300px;
        }
        
        #react-mount {
            background: #1f2937;
            border: 2px dashed #374151;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .mounted {
            border-color: #10b981 !important;
            background: #064e3b !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test React Mobile Simple</h1>
        
        <div class="status" id="status">
            üîÑ Initialisation du test...
        </div>
        
        <div id="react-mount">
            ‚è≥ En attente du montage React...
        </div>
        
        <button onclick="testMainApp()">üì± Aller √† l'App Principale</button>
        <button onclick="runDiagnostic()">üîç Diagnostic Complet</button>
        <button onclick="clearAndReload()">üßπ Nettoyer & Recharger</button>
    </div>

    <script type="module">
        const status = document.getElementById('status');
        const reactMount = document.getElementById('react-mount');
        
        function updateStatus(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            status.innerHTML += `<br>${icon} [${timestamp}] ${message}`;
            status.scrollTop = status.scrollHeight;
        }
        
        // Test 1: V√©rifier si les modules ES6 fonctionnent
        updateStatus('Test modules ES6: ‚úÖ', 'success');
        
        // Test 2: Tenter de charger React depuis CDN
        async function loadReactFromCDN() {
            try {
                updateStatus('Chargement React depuis CDN...');
                
                // Charger React
                const reactScript = document.createElement('script');
                reactScript.src = 'https://unpkg.com/react@18/umd/react.development.js';
                reactScript.crossOrigin = 'anonymous';
                
                const reactDOMScript = document.createElement('script');
                reactDOMScript.src = 'https://unpkg.com/react-dom@18/umd/react-dom.development.js';
                reactDOMScript.crossOrigin = 'anonymous';
                
                document.head.appendChild(reactScript);
                
                reactScript.onload = () => {
                    updateStatus('React core charg√© ‚úÖ', 'success');
                    document.head.appendChild(reactDOMScript);
                };
                
                reactDOMScript.onload = () => {
                    updateStatus('React DOM charg√© ‚úÖ', 'success');
                    testReactMount();
                };
                
                reactScript.onerror = () => {
                    updateStatus('Erreur chargement React ‚ùå', 'error');
                };
                
                reactDOMScript.onerror = () => {
                    updateStatus('Erreur chargement React DOM ‚ùå', 'error');
                };
                
            } catch (error) {
                updateStatus(`Erreur CDN: ${error.message}`, 'error');
            }
        }
        
        // Test 3: Monter un composant React simple
        function testReactMount() {
            try {
                if (typeof React === 'undefined') {
                    updateStatus('React non disponible ‚ùå', 'error');
                    return;
                }
                
                updateStatus('Tentative de montage React...');
                
                // Cr√©er un composant simple
                const TestComponent = React.createElement('div', {
                    style: { 
                        padding: '20px', 
                        background: '#10b981', 
                        borderRadius: '8px',
                        color: 'white',
                        fontWeight: 'bold'
                    }
                }, 'üéâ React fonctionne sur mobile !');
                
                // Monter le composant
                const reactRoot = ReactDOM.createRoot(reactMount);
                reactRoot.render(TestComponent);
                
                reactMount.classList.add('mounted');
                updateStatus('React mont√© avec succ√®s ‚úÖ', 'success');
                
                // Test de re-render
                setTimeout(() => {
                    const updatedComponent = React.createElement('div', {
                        style: { 
                            padding: '20px', 
                            background: '#059669', 
                            borderRadius: '8px',
                            color: 'white',
                            fontWeight: 'bold'
                        }
                    }, 'üöÄ React + Re-render OK !');
                    
                    reactRoot.render(updatedComponent);
                    updateStatus('Re-render test√© ‚úÖ', 'success');
                }, 2000);
                
            } catch (error) {
                updateStatus(`Erreur montage: ${error.message}`, 'error');
            }
        }
        
        // Test 4: V√©rifier la connectivit√© vers l'app principale
        async function testMainAppConnectivity() {
            try {
                updateStatus('Test connectivit√© app principale...');
                
                const response = await fetch('/', { 
                    method: 'HEAD',
                    cache: 'no-cache'
                });
                
                if (response.ok) {
                    updateStatus(`App principale accessible (${response.status}) ‚úÖ`, 'success');
                } else {
                    updateStatus(`App principale erreur ${response.status} ‚ùå`, 'error');
                }
                
            } catch (error) {
                updateStatus(`Connectivit√© app: ${error.message}`, 'error');
            }
        }
        
        // Fonctions globales pour les boutons
        window.testMainApp = () => {
            updateStatus('Redirection vers app principale...');
            setTimeout(() => window.location.href = '/', 1000);
        };
        
        window.runDiagnostic = () => {
            updateStatus('Redirection vers diagnostic...');
            setTimeout(() => window.location.href = '/mobile-diagnostic.html', 1000);
        };
        
        window.clearAndReload = async () => {
            updateStatus('Nettoyage et rechargement...');
            
            try {
                const cacheNames = await caches.keys();
                for (const name of cacheNames) {
                    await caches.delete(name);
                }
                localStorage.clear();
                sessionStorage.clear();
                
                setTimeout(() => location.reload(true), 1000);
            } catch (error) {
                updateStatus(`Erreur nettoyage: ${error.message}`, 'error');
            }
        };
        
        // D√©marrer les tests
        updateStatus('üöÄ D√©but des tests React mobile');
        
        // Tests de base
        updateStatus(`User Agent: ${navigator.userAgent.substring(0, 50)}...`);
        updateStatus(`√âcran: ${screen.width}x${screen.height}, Ratio: ${window.devicePixelRatio}`);
        updateStatus(`Viewport: ${window.innerWidth}x${window.innerHeight}`);
        updateStatus(`Touch: ${('ontouchstart' in window) ? 'Support√©' : 'Non support√©'}`);
        
        // Lancer les tests async
        loadReactFromCDN();
        testMainAppConnectivity();
        
        // Gestion d'erreurs globale
        window.addEventListener('error', (e) => {
            updateStatus(`ERREUR GLOBALE: ${e.message}`, 'error');
        });
        
        window.addEventListener('unhandledrejection', (e) => {
            updateStatus(`PROMISE REJET√âE: ${e.reason}`, 'error');
        });
        
    </script>
</body>
</html>
