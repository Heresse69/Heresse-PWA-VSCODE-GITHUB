<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🚨 URGENCE - Test App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #ffffff;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            text-align: center;
        }
        
        .status {
            background: #333;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            text-align: left;
            font-family: monospace;
            font-size: 14px;
        }
        
        button {
            background: #10b981;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 10px;
            width: 100%;
            max-width: 300px;
        }
        
        button:hover {
            background: #059669;
        }
        
        .error { color: #ef4444; }
        .success { color: #10b981; }
        .warning { color: #fbbf24; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚨 URGENCE - Diagnostic App</h1>
        <p>Cette page teste si le serveur fonctionne au minimum</p>
        
        <div class="status" id="status">
            ✅ Cette page HTML fonctionne !<br>
            🔄 Test JavaScript en cours...
        </div>
        
        <button onclick="testReact()">🧪 Test React</button>
        <button onclick="testMainApp()">📱 Test App Principale</button>
        <button onclick="fixApp()">🔧 Réparer l'App</button>
    </div>

    <script>
        const status = document.getElementById('status');
        
        function addStatus(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'success' ? '✅' : type === 'error' ? '❌' : 'ℹ️';
            status.innerHTML += `<br>${icon} [${timestamp}] ${message}`;
        }
        
        // Test JavaScript de base
        addStatus('JavaScript fonctionne !', 'success');
        addStatus(`User Agent: ${navigator.userAgent.substring(0, 40)}...`);
        addStatus(`Screen: ${screen.width}x${screen.height}`);
        addStatus(`Viewport: ${window.innerWidth}x${window.innerHeight}`);
        
        // Test des APIs
        if ('serviceWorker' in navigator) {
            addStatus('Service Worker supporté', 'success');
        } else {
            addStatus('Service Worker NON supporté', 'error');
        }
        
        if ('fetch' in window) {
            addStatus('Fetch API disponible', 'success');
        } else {
            addStatus('Fetch API NON disponible', 'error');
        }
        
        function testReact() {
            addStatus('🧪 Test de chargement React...');
            
            // Créer un script React
            const script = document.createElement('script');
            script.src = 'https://unpkg.com/react@18/umd/react.development.js';
            script.crossOrigin = 'anonymous';
            
            script.onload = () => {
                addStatus('React chargé depuis CDN !', 'success');
                
                // Test du DOM React
                const reactDiv = document.createElement('div');
                reactDiv.id = 'react-test';
                reactDiv.style.cssText = 'background: #10b981; padding: 20px; border-radius: 8px; margin: 20px 0; color: white; font-weight: bold;';
                reactDiv.innerHTML = '🎉 React fonctionne !';
                document.body.appendChild(reactDiv);
            };
            
            script.onerror = () => {
                addStatus('Erreur chargement React', 'error');
            };
            
            document.head.appendChild(script);
        }
        
        function testMainApp() {
            addStatus('🔄 Test de l\'app principale...');
            
            fetch('/')
                .then(response => {
                    if (response.ok) {
                        addStatus('App principale accessible !', 'success');
                        setTimeout(() => {
                            window.location.href = '/';
                        }, 2000);
                    } else {
                        addStatus(`Erreur app principale: ${response.status}`, 'error');
                    }
                })
                .catch(error => {
                    addStatus(`Erreur réseau: ${error.message}`, 'error');
                });
        }
        
        function fixApp() {
            addStatus('🔧 Tentative de réparation...');
            
            // Nettoyer les caches
            if ('caches' in window) {
                caches.keys().then(names => {
                    return Promise.all(names.map(name => caches.delete(name)));
                }).then(() => {
                    addStatus('Cache nettoyé', 'success');
                });
            }
            
            // Désactiver service workers
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(registrations => {
                    return Promise.all(registrations.map(reg => reg.unregister()));
                }).then(() => {
                    addStatus('Service Workers supprimés', 'success');
                });
            }
            
            // Vider storage
            localStorage.clear();
            sessionStorage.clear();
            addStatus('Storage vidé', 'success');
            
            addStatus('🔄 Rechargement dans 3 secondes...', 'success');
            setTimeout(() => {
                location.reload(true);
            }, 3000);
        }
        
        // Test automatique après 2 secondes
        setTimeout(() => {
            addStatus('🔍 Test automatique de l\'app...');
            testMainApp();
        }, 2000);
    </script>
</body>
</html>
